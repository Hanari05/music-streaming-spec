<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ğŸŒ¸ Pastel Music Demo</title>
<style>
/* --- Style chÃ­nh (giá»¯ phong cÃ¡ch pastel) --- */
:root {
  --pink: #fcdce1;
  --white: #fff;
  --lav: #f6ecf7;
  --mint: #e7f5f2;
  --text: #444;
  --card-shadow: 0 2px 6px rgba(0,0,0,0.06);
}
*{box-sizing:border-box}
body { font-family: "Poppins", sans-serif; margin: 0; background: var(--lav); color: var(--text); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;}
header { background: var(--pink); padding: 1.2em; text-align: center; font-weight: 600; font-size: 1.4em; color: #444; box-shadow: 0 2px 5px rgba(0,0,0,0.1); position: sticky; top:0; z-index: 10;}
nav { display: flex; justify-content: center; background: var(--white); gap: 1em; padding: 0.8em; flex-wrap: wrap; position: sticky; top:64px; z-index: 9; }
nav button { border: none; background: var(--mint); padding: 0.6em 1.2em; border-radius: 1em; cursor: pointer; transition: 0.2s; font-weight:300;}
nav button:hover { background: var(--pink); transform: translateY(-2px); }
main { padding: 1.2em; max-width: 900px; margin: auto; transition: padding-bottom 0.2s ease; }
.hidden { display: none;}
.grid { display: grid; grid-template-columns: repeat(auto-fit,minmax(200px,1fr)); gap: 1em; align-items:start; }
.card { background: var(--white); border-radius: 12px; padding: 1.2em; text-align: center; box-shadow: var(--card-shadow); transition: transform .15s, background .15s; cursor: pointer; }
.card:hover { transform: translateY(-6px); background: #fff6fb; }
#player { position: fixed; bottom: 12px; left: 12px; right: 12px; background: var(--white); padding: 12px 16px; display:flex; align-items:center; gap: 12px; border-radius: 12px; box-shadow: 0 8px 28px rgba(0,0,0,0.12); z-index: 999; }
#player-left { display:flex; align-items:center; gap:12px; min-width: 0; }
#player-info { display:flex; flex-direction:column; min-width: 0; overflow:hidden; }
#now-title { font-weight:700; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
#now-artist { font-size:0.86em; color:#666; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
#player-controls { flex: 1; display:flex; align-items:center; gap:8px; min-width:0; }
#player audio{ width:100%; }
.small-btn { background:none; border:none; font-size:1.1em; cursor:pointer; padding:6px; border-radius:8px; }
.small-btn:hover{ background:var(--mint); }
.track-actions { margin-top:0.75em; display:flex; gap:8px; justify-content:center; flex-wrap:wrap; }
.add-playlist-btn { background:var(--pink); border:none; padding:1em 1em; border-radius:30px; margin-top: 1em; cursor:pointer; font-weight:200; }
.add-playlist-btn:hover{ background:var(--mint); }

#playlist-detail { background: rgba(246,236,247,0.6); padding: 1em; border-radius: 1px; box-shadow: var(--card-shadow); margin-top: 1em; }
.track-list { list-style: none; padding: 0; margin: 0; }
.track-list li { display: flex; justify-content: space-between; align-items: center; background: var(--white); border-radius: 0.8em; padding: 0.7em 1em; margin-bottom: 0.5em; cursor: pointer; box-shadow: 0 2px 6px rgba(0,0,0,0.04); }
.track-list li:hover { transform: translateY(-4px); background: #f3fff9; }

.admin-table { width: 100%; border-collapse: collapse; margin-top: 0.6em; }
.admin-table th, .admin-table td { padding: 0.6em; border-bottom: 1px solid #eee; text-align: left; }
.admin-table th { background: var(--mint); }

.footer-space { height: 0; } /* will be set dynamically */

/* responsive tweaks */
@media (max-width:600px){
  nav { gap: 0.5em; padding: 0.6em; }
  header { font-size:1.1em; }
  .grid { grid-template-columns: repeat(auto-fit,minmax(150px,1fr)); }
  #player { left:8px; right:8px; bottom:8px; padding:10px; }
}
</style>
</head>
<body>

<header>ğŸŒ¸ Pastel Music Demo</header>

<nav>
  <button onclick="showView('home')">Trang chá»§</button>
  <button onclick="showView('tracks')">Tracks</button>
  <button onclick="showView('search')">TÃ¬m kiáº¿m</button>
  <button onclick="showView('playlists')">Playlists</button>
  <button onclick="showView('artists')">Nghá»‡ sÄ©</button>
  <button onclick="showView('history')">Lá»‹ch sá»­</button>
  <button onclick="showView('admin')">Admin</button>
</nav>

<main id="main-content">
  <section id="home" class="view">
    <h2>ğŸŒ· KhÃ¡m phÃ¡ Pastel Music</h2>
    <p>ğŸµ Pastel Music mang Ä‘áº¿n khÃ´ng gian Ã¢m nháº¡c nháº¹ nhÃ ng, dá»… thÆ°Æ¡ng vÃ  Ä‘áº§y cáº£m xÃºc.<br><br>
    ChÃ o má»«ng Ä‘áº¿n vá»›i Prototype Web nháº¡c cá»§a HÃ¢n. ÄÃ¢y lÃ  nÆ¡i Ä‘á»ƒ HÃ¢n thá»ƒ hiá»‡n cáº£m xÃºc vÃ  mÃ u sáº¯c cá»§a mÃ¬nh thÃ´ng qua Ã¢m nháº¡c vÃ  thiáº¿t káº¿~<br><br>
	 HÃ£y báº¯t Ä‘áº§u báº±ng cÃ¡ch lÆ°á»›t qua Tracks hoáº·c tÃ¬m kiáº¿m bÃ i hÃ¡t mÃ  báº¡n yÃªu thÃ­ch nhÃ© !</p>
  </section>

  <section id="tracks" class="view hidden">
    <h2>ğŸ§ Danh sÃ¡ch bÃ i hÃ¡t</h2>
    <div id="track-list" class="grid"></div>
  </section>

  <section id="search" class="view hidden">
    <h2>ğŸˆ TÃ¬m kiáº¿m bÃ i hÃ¡t</h2>
    <input id="searchInput" type="text" placeholder="Nháº­p tÃªn bÃ i hÃ¡t hoáº·c nghá»‡ sÄ©..." style="padding:0.6em;width:100%;border-radius:1em;border:none;">
    <div id="searchResult" class="grid" style="margin-top:1em;"></div>
  </section>

  <section id="playlists" class="view hidden">
    <h2>ğŸ¼ Playlists</h2>
    <div id="playlist-list" class="grid"></div>

    <div id="playlist-detail" class="hidden">
      <h3 id="playlist-title"></h3>
      <ul id="playlist-tracks" class="track-list"></ul>
    </div>

    <button class="add-btn add-playlist-btn" onclick="addPlaylist()">+ Táº¡o Playlist Má»›i</button>
  </section>

  <section id="artists" class="view hidden">
    <h2>ğŸ™ Nghá»‡ sÄ© ná»•i báº­t</h2>
    <div id="artist-list" class="grid"></div>

    <div id="albums-section" style="margin-top:2em;">
      <h3>ğŸ““ Albums</h3>
      <div id="album-list" class="grid"></div>
    </div>
  </section>

  <section id="history" class="view hidden">
    <h2>ğŸ“¼ Lá»‹ch sá»­ nghe</h2>
    <ul id="history-list"></ul>
  </section>

  <section id="admin" class="view hidden">
    <h2>ğŸ›ï¸ Khu vá»±c Admin (CRUD ná»™i dung)</h2>
    <table class="admin-table">
      <thead><tr><th>ID</th><th>TÃªn bÃ i hÃ¡t</th><th>Nghá»‡ sÄ©</th><th>URL (music/...)</th><th>Thao tÃ¡c</th></tr></thead>
      <tbody id="admin-track-body"></tbody>
    </table>
    <button class="add-btn add-playlist-btn" onclick="addTrack()">+ ThÃªm bÃ i hÃ¡t</button>
  </section>

  <div id="footer-space" class="footer-space"></div>
</main>

<!-- Player cá»‘ Ä‘á»‹nh -->
<footer id="player" aria-label="Player">
  <div id="player-left">
    <button class="small-btn" id="prevBtn" title="TrÆ°á»›c" onclick="prevTrack()">â®</button>
    <button class="small-btn" id="playBtn" title="Play/Pause" onclick="togglePlay()">â¯</button>
  </div>

  <div id="player-info">
    <div id="now-title">KhÃ´ng cÃ³ bÃ i Ä‘ang phÃ¡t</div>
    <div id="now-artist"></div>
  </div>

  <div id="player-controls">
    <audio id="audio" controls></audio>
  </div>

  <div>
    <button class="small-btn" title="Dá»«ng vÃ  xÃ³a lá»‹ch sá»­" onclick="clearHistory()">ğŸ—‘ Lá»‹ch sá»­</button>
  </div>
</footer>

<script>
/* ============================
   Dá»¯ liá»‡u máº«u (seed) máº·c Ä‘á»‹nh
   ============================ */
const DEFAULT_SEED = {
  artists: [
    { id:1, name:"BLACKPINK" }, { id:2, name:"IU" }, { id:3, name:"YOASOBI" },
    { id:4, name:"Taylor Swift" }, { id:5, name:"SÆ¡n TÃ¹ng M-TP" },
    { id:6, name:"Äen VÃ¢u" }, { id:7, name:"NewJeans" },
    { id:8, name:"VÅ©" }, { id:9, name:"Min" }, { id:10, name:"Ariana Grande" }
  ],
  albums: [
    { id:1, name:"BORN PINK", artist:"BLACKPINK" },
    { id:2, name:"Love Poem", artist:"IU" },
    { id:3, name:"THE BOOK", artist:"YOASOBI" },
    { id:4, name:"1989 (Taylorâ€™s Version)", artist:"Taylor Swift" },
    { id:5, name:"Made For Love", artist:"SÆ¡n TÃ¹ng M-TP" },
    { id:6, name:"Äi Trong MÃ¹a HÃ¨", artist:"Äen VÃ¢u" }
  ],
  tracks: [
    { id:1, title:"Pink Venom", artist:"BLACKPINK", url:"music/Pink-Venom.mp3"},
    { id:2, title:"Lovesick Girls", artist:"BLACKPINK", url:"music/Lovesick-Girls.mp3"},
    { id:3, title:"Love Poem", artist:"IU", url:"music/Love-Poem-Iu.mp3"},
    { id:4, title:"Yoru ni Kakeru", artist:"YOASOBI", url:"music/Yoru-Ni-Kakeru.mp3"},
    { id:5, title:"Lover", artist:"Taylor Swift", url:"music/Lover.mp3"},
    { id:6, title:"ChÃºng Ta Cá»§a Hiá»‡n Táº¡i", artist:"SÆ¡n TÃ¹ng M-TP", url:"music/Chung-ta-cua-hien-tai.mp3"},
    { id:7, title:"Trá»‘n TÃ¬m", artist:"Äen VÃ¢u", url:"music/Tron-tim.mp3"},
    { id:8, title:"Hype Boy", artist:"NewJeans", url:"music/Hype-Boy.mp3"},
    { id:9, title:"BÆ°á»›c Qua MÃ¹a CÃ´ ÄÆ¡n", artist:"VÅ©", url:"music/Buoc-qua-mua-co-don.mp3"},
    { id:10, title:"YÃªu 5", artist:"Min", url:"music/Yeu-5.mp3"},
    { id:11, title:"7 rings", artist:"Ariana Grande", url:"music/7-Rings.mp3"},
    { id:12, title:"Anti-Hero", artist:"Taylor Swift", url:"music/Anti-hero.mp3"},
    { id:13, title:"Vá»‹ nhÃ ", artist:"Äen VÃ¢u", url:"music/Vi-nha.mp3"},
    { id:14, title:"Forever Young", artist:"BLACKPINK", url:"music/Forever-Young.mp3"},
    { id:15, title:"SoulMate", artist:"IU", url:"music/SoulMate.mp3"},
    { id:16, title:"ETA", artist:"NewJeans", url:"music/ETA.mp3"},
    { id:17, title:"Ã‚m tháº§m bÃªn em", artist:"SÆ¡n TÃ¹ng M-TP", url:"music/Am-tham-ben-em.mp3"},
    { id:18, title:"My Favorite Clothes", artist:"RINI", url:"music/My-Favorite-Clothes.mp3"},
    { id:19, title:"Shinunoga E-Wa", artist:"Fujii Kaze", url:"music/Shinunoga-E-Wa.mp3"},
    { id:20, title:"Positions", artist:"Ariana Grande", url:"music/positions.mp3"}
  ],
  playlists: [
    { id:1, name:"Chill Pastel", tracks:[3,7,9,10] },
    { id:2, name:"Pop Love Mix", tracks:[1,5,12,20] },
    { id:3, name:"Vibes of Vietnam", tracks:[6,7,9,10,13,17] },
    { id:4, name:"Study & Focus", tracks:[3,4,8,15,18,19] },
    { id:5, name:"Kpop Energy", tracks:[1,2,8,14,16] }
  ],
  history: []
};

/* ================
   Storage helpers
   ================ */
const STORAGE_KEY = 'pastel_music_v1';

function loadSeed(){
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) {
      localStorage.setItem(STORAGE_key_fallback(), JSON.stringify(DEFAULT_SEED)); // safety
      return JSON.parse(JSON.stringify(DEFAULT_SEED));
    }
    return JSON.parse(raw);
  } catch(e) {
    console.error("Lá»—i loadStorage:", e);
    return JSON.parse(JSON.stringify(DEFAULT_SEED));
  }
}
function saveSeed(data){
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  } catch(e) {
    console.error("Lá»—i saveStorage:", e);
  }
}
function STORAGE_key_fallback(){ return STORAGE_KEY; }

/* ================
   Global state
   ================ */
let seed = loadSeed();
let currentTrackId = null;

/* ================
   View rendering
   ================ */
function showView(id){
  document.querySelectorAll('.view').forEach(v=>v.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
  if(id==='playlists') renderPlaylists();
  if(id==='artists') { renderArtists(); renderAlbums(); }
  if(id==='tracks') renderTracks();
  if(id==='history') renderHistory();
  if(id==='admin') renderAdminTracks();
}

/* Tracks */
function renderTracks(){
  const container=document.getElementById("track-list");
  container.innerHTML="";
  seed.tracks.forEach(t=>{
    const div=document.createElement("div");
    div.className="card";
    // ná»™i dung
    div.innerHTML = `
      <div style="font-weight:700">${escapeHtml(t.title)}</div>
      <div style="color:#666;margin-top:6px">${escapeHtml(t.artist)}</div>
      <div class="track-actions">
        <button class="add-playlist-btn" onclick="event.stopPropagation(); addToPlaylistPrompt(${t.id})">+ ThÃªm vÃ o playlist</button>
        <button class="small-btn" onclick="event.stopPropagation(); playById(${t.id})">â–¶ï¸ PhÃ¡t</button>
      </div>
    `;
    div.onclick = ()=>playById(t.id);
    container.appendChild(div);
  });
}

/* Search */
function doSearch(){
  const q=document.getElementById("searchInput").value.trim().toLowerCase();
  const res=document.getElementById("searchResult");
  res.innerHTML="";
  if(!q) return;
  seed.tracks.filter(t=>t.title.toLowerCase().includes(q)||t.artist.toLowerCase().includes(q))
  .forEach(t=>{
    const div=document.createElement("div");
    div.className="card";
    div.innerHTML = `<div style="font-weight:700">${escapeHtml(t.title)}</div>
      <div style="color:#666;margin-top:6px">${escapeHtml(t.artist)}</div>
      <div class="track-actions">
        <button class="add-playlist-btn" onclick="event.stopPropagation(); addToPlaylistPrompt(${t.id})">+ Playlist</button>
        <button class="small-btn" onclick="event.stopPropagation(); playById(${t.id})">â–¶ï¸ Play</button>
      </div>`;
    div.onclick = ()=>playById(t.id);
    res.appendChild(div);
  });
}
document.getElementById("searchInput").addEventListener("input", doSearch);

/* Playlists */
function renderPlaylists(){
  const container=document.getElementById("playlist-list");
  container.innerHTML="";
  seed.playlists.forEach(pl=>{
    const div=document.createElement("div");
    div.className="card";
    div.innerHTML = `<h3 style="margin:0">${escapeHtml(pl.name)}</h3><p style="color:#666;margin-top:8px">${pl.tracks.length} bÃ i hÃ¡t</p>`;
    div.onclick = ()=>showPlaylistDetail(pl.id);
    container.appendChild(div);
  });
}

function showPlaylistDetail(id){
  const playlist=seed.playlists.find(p=>p.id===id);
  if(!playlist) return;
  document.getElementById("playlist-title").textContent = playlist.name;
  const list=document.getElementById("playlist-tracks");
  list.innerHTML="";
  playlist.tracks.forEach(tid=>{
    const t = seed.tracks.find(tr=>tr.id===tid);
    if(t){
      const li = document.createElement("li");
      li.innerHTML = `<span style="min-width:0;"><strong>${escapeHtml(t.title)}</strong> - <em style="color:#666">${escapeHtml(t.artist)}</em></span>
        <span style="display:flex;gap:8px">
          <button class="small-btn" onclick="event.stopPropagation(); playById(${t.id})">â–¶ï¸</button>
          <button class="small-btn" onclick="event.stopPropagation(); removeFromPlaylist(${playlist.id}, ${t.id})">â–</button>
        </span>`;
      li.onclick = ()=>playById(t.id);
      list.appendChild(li);
    }
  });
  document.getElementById("playlist-detail").classList.remove("hidden");
}

/* Remove from playlist */
function removeFromPlaylist(playlistId, trackId){
  const pl = seed.playlists.find(p=>p.id===playlistId);
  if(!pl) return;
  const idx = pl.tracks.indexOf(trackId);
  if(idx>-1){
    pl.tracks.splice(idx,1);
    saveSeed(seed);
    renderPlaylists();
    showPlaylistDetail(playlistId);
  }
}

/* Add playlist */
function addPlaylist(){
  const name = prompt("Nháº­p tÃªn playlist má»›i:");
  if(!name) return;
  const newId = seed.playlists.length ? Math.max(...seed.playlists.map(p=>p.id))+1 : 1;
  seed.playlists.push({id:newId, name: name.trim(), tracks: []});
  saveSeed(seed);
  renderPlaylists();
  alert("Táº¡o playlist thÃ nh cÃ´ng!");
}

/* Add to playlist prompt */
function addToPlaylistPrompt(trackId){
  if(!seed.playlists.length){
    if(confirm("ChÆ°a cÃ³ playlist nÃ o. Táº¡o má»›i?")) { addPlaylist(); }
    return;
  }
  // Build prompt string with numbered options
  let promptTxt = "Chá»n playlist (nháº­p sá»‘):\n";
  seed.playlists.forEach((p,i)=> promptTxt += `${i+1}. ${p.name} (${p.tracks.length} bÃ i)\n`);
  promptTxt += `${seed.playlists.length+1}. Táº¡o playlist má»›i\n\nNháº­p sá»‘:`;
  const ans = prompt(promptTxt);
  if(!ans) return;
  const n = parseInt(ans);
  if(isNaN(n)) return alert("GiÃ¡ trá»‹ khÃ´ng há»£p lá»‡");
  if(n === seed.playlists.length+1){
    addPlaylist();
    return;
  }
  const target = seed.playlists[n-1];
  if(!target) return alert("KhÃ´ng tÃ¬m tháº¥y playlist");
  if(!target.tracks.includes(trackId)) target.tracks.push(trackId);
  saveSeed(seed);
  alert(`ÄÃ£ thÃªm vÃ o "${target.name}"`);
  // refresh playlist view counts if visible
  if(!document.getElementById("playlist-list").classList.contains("hidden")) renderPlaylists();
}

/* History */
function renderHistory(){
  const list=document.getElementById("history-list");
  list.innerHTML="";
  seed.history.forEach(h=>{
    const li = document.createElement("li");
    li.textContent = h;
    list.appendChild(li);
  });
}
function clearHistory(){
  if(confirm("XÃ³a toÃ n bá»™ lá»‹ch sá»­ nghe?")){
    seed.history = [];
    saveSeed(seed);
    renderHistory();
  }
}

/* Admin (CRUD) */
function renderAdminTracks(){
  const tbody=document.getElementById("admin-track-body");
  tbody.innerHTML="";
  seed.tracks.forEach(t=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${t.id}</td>
      <td>${escapeHtml(t.title)}</td>
      <td>${escapeHtml(t.artist)}</td>
      <td style="max-width:260px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${escapeHtml(t.url||'')}</td>
      <td>
        <button onclick="editTrack(${t.id})">âœï¸</button>
        <button onclick="deleteTrack(${t.id})">ğŸ—‘ï¸</button>
      </td>`;
    tbody.appendChild(tr);
  });
}

function addTrack(){
  const title = prompt("TÃªn bÃ i hÃ¡t:");
  if(!title) return;
  const artist = prompt("Nghá»‡ sÄ©:");
  if(!artist) return;
  const url = prompt("ÄÆ°á»ng dáº«n file (vÃ­ dá»¥ music/file.mp3). Äá»ƒ trá»‘ng náº¿u chÆ°a cÃ³:");
  const newId = seed.tracks.length ? Math.max(...seed.tracks.map(t=>t.id))+1 : 1;
  seed.tracks.push({id:newId, title:title.trim(), artist:artist.trim(), url: url ? url.trim() : ""});
  saveSeed(seed);
  renderAdminTracks();
  renderTracks();
  alert("ÄÃ£ thÃªm bÃ i hÃ¡t má»›i.");
}

function editTrack(id){
  const t = seed.tracks.find(x=>x.id===id);
  if(!t) return;
  const newTitle = prompt("TÃªn bÃ i má»›i:", t.title);
  const newArtist = prompt("Nghá»‡ sÄ© má»›i:", t.artist);
  const newUrl = prompt("URL file (music/...):", t.url || "");
  if(newTitle) t.title = newTitle.trim();
  if(newArtist) t.artist = newArtist.trim();
  t.url = newUrl ? newUrl.trim() : "";
  saveSeed(seed);
  renderAdminTracks();
  renderTracks();
}

function deleteTrack(id){
  if(!confirm("XÃ³a bÃ i hÃ¡t nÃ y?")) return;
  const idx = seed.tracks.findIndex(t=>t.id===id);
  if(idx>-1) seed.tracks.splice(idx,1);
  // remove from playlists too
  seed.playlists.forEach(pl => {
    const i = pl.tracks.indexOf(id);
    if(i>-1) pl.tracks.splice(i,1);
  });
  saveSeed(seed);
  renderAdminTracks();
  renderTracks();
}

/* ================
   Playback controls
   ================ */
const audioEl = document.getElementById("audio");
const nowTitleEl = document.getElementById("now-title");
const nowArtistEl = document.getElementById("now-artist");
const playBtn = document.getElementById("playBtn");

function playById(id){
  const track = seed.tracks.find(t=>t.id===id);
  if(!track){
    alert("KhÃ´ng tÃ¬m tháº¥y bÃ i hÃ¡t.");
    return;
  }
  if(!track.url){
    alert("BÃ i nÃ y chÆ°a cÃ³ file (URL trá»‘ng). Báº¡n cÃ³ thá»ƒ thÃªm URL á»Ÿ pháº§n Admin.");
    return;
  }
  currentTrackId = id;
  audioEl.src = track.url;
  audioEl.play().catch(err=>{
    console.warn("Lá»—i phÃ¡t:", err);
    alert("KhÃ´ng thá»ƒ phÃ¡t file (kiá»ƒm tra Ä‘Æ°á»ng dáº«n hoáº·c cross-origin náº¿u cháº¡y tá»« server).");
  });
  // update now playing display
  nowTitleEl.textContent = track.title;
  nowArtistEl.textContent = track.artist;
  updatePlayBtn(true);
  // update history
  const label = `${track.title} - ${track.artist}`;
  seed.history.unshift(label);
  // keep only 30 records max
  if(seed.history.length > 30) seed.history.length = 30;
  saveSeed(seed);
  renderHistory();
}

function togglePlay(){
  if(audioEl.paused){
    audioEl.play();
  } else {
    audioEl.pause();
  }
}
function updatePlayBtn(isPlaying){
  playBtn.textContent = isPlaying ? "â¸" : "â¯";
}
audioEl.addEventListener('play', ()=> updatePlayBtn(true));
audioEl.addEventListener('pause', ()=> updatePlayBtn(false));
audioEl.addEventListener('ended', ()=> {
  updatePlayBtn(false);
  // try next in playlist: simple behavior = stop
});

/* Prev/Next (basic prev: previous history) */
function prevTrack(){
  if(!seed.history.length) return;
  // tÃ¬m track id cá»§a má»¥c lá»‹ch sá»­ thá»© 2 (vÃ¬ lá»‹ch sá»­[0] lÃ  hiá»‡n táº¡i)
  const curLabel = seed.history[0];
  const idx = seed.history.findIndex(h=>h===curLabel);
  if(idx>0){
    // not very robust: find last played different from current
    const prevLabel = seed.history[1];
    const track = seed.tracks.find(t=>`${t.title} - ${t.artist}` === prevLabel);
    if(track) playById(track.id);
  } else {
    alert("KhÃ´ng cÃ³ bÃ i trÆ°á»›c trong lá»‹ch sá»­.");
  }
}

/* Escape HTML helper */
function escapeHtml(str){
  if(!str) return '';
  return String(str).replace(/[&<>"']/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]; });
}

/* Render artists/albums */
function renderArtists(){
  const list=document.getElementById("artist-list");
  list.innerHTML="";
  seed.artists.forEach(a=>{
    const div=document.createElement("div");
    div.className="card";
    div.textContent=a.name;
    list.appendChild(div);
  });
}
function renderAlbums(){
  const list=document.getElementById("album-list");
  list.innerHTML="";
  seed.albums.forEach(al=>{
    const div=document.createElement("div");
    div.className="card";
    div.textContent=`${al.name} - ${al.artist}`;
    list.appendChild(div);
  });
}

/* Utility: ensure main padding-bottom equals player height + margin
   -> Prevent player from covering page content */
function adjustMainPaddingForPlayer(){
  const main = document.getElementById("main-content");
  const player = document.getElementById("player");
  // compute height including margins
  const rect = player.getBoundingClientRect();
  const height = rect.height + 20; // extra margin
  main.style.paddingBottom = height + "px";
  // also set footer-space for older browsers
  const footerSpace = document.getElementById("footer-space");
  if(footerSpace) footerSpace.style.height = (height - 12) + "px";
}

/* On load: render initial view and adjust padding */
function init(){
  // If localStorage empty, initialize
  if(!localStorage.getItem(STORAGE_KEY)){
    saveSeed(seed);
  } else {
    seed = loadSeed();
  }

  renderTracks();
  renderArtists();
  renderAlbums();
  renderPlaylists();
  renderAdminTracks();
  renderHistory();

  // restore last playing track (optional)
  // keep currentTrackId null until user plays

  // adjust padding now and on resize / mutation
  adjustMainPaddingForPlayer();
  window.addEventListener('resize', adjustMainPaddingForPlayer);
  // also observe player size changes (in case controls appear)
  const ro = new ResizeObserver(adjustMainPaddingForPlayer);
  ro.observe(document.getElementById("player"));

  // default to home
  showView('home'); 
}

/* Save on beforeunload just in case */
window.addEventListener('beforeunload', ()=> saveSeed(seed));

/* Start */
window.onload = init;

/* Small helper: add event to play when pressing Enter in search input */
document.getElementById("searchInput").addEventListener("keydown", function(e){
  if(e.key === "Enter") doSearch();
});
</script>
</body>
</html>
